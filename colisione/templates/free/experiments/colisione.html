{% extends 'free/experiment.html' %}
{% load static %}
{% load i18n %}


{% block experiment_head %}
    <!-- pendulum libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.8.0/dist/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/1.4.0/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/1.2.1/chartjs-plugin-zoom.min.js"></script>

     <!-- slider  -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.8.4/components/slider.min.js"></script>
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.8.4/components/slider.min.css">
 
    <!-- pendulum libraries -->


    <script src="https://unpkg.com/chartjs-chart-error-bars@3.7.2/build/index.umd.min.js"></script>
    <script src="https://d3js.org/d3-array.v3.min.js"></script>


{% endblock %}  


{% block configtab %}
<!-- Begin of the configuration tab-->
    
    
        <div class="ui two column grid container">
            <div class="column">
                <div class="ui segment">
                    <legend> <h3>{% trans 'Pulse given to car A (%)'%}</h3></legend>
					<div style="padding-top: 5%;"  class="ui blue small bottom aligned labeled  slider"  id="slider-poder_acel1" ></div>
                        <div class="ui input">
                            <input class="free-input" type="number" id="poder_acel1">
                        </div>
                </div>
            </div>
            <div class="column">
                <div class="ui segment">
                    <legend><h3>{% trans 'Pulse given to car B (%)'%}</h3></legend>
                    <div style="padding-top: 5%;"  class="ui blue small bottom aligned labeled  slider"  id="slider-poder_acel2" ></div>
                        <div class="ui input">
                            <input class="free-input" type="number" id="poder_acel2">
                        </div>
                </div>
            </div>
			<!--2-->
            <div class="column">
                <div class="ui segment">
                    <legend><h3>{% trans 'Camera'%}</h3></legend>
                    <div style="padding-top: 5%;"  class="ui blue small bottom aligned labeled  slider"  id="slider-cam_segue" ></div>
                        <div class="ui input">
                            <input class="free-input" type="number" id="cam_segue">
                        </div>
                </div>
            </div>
        </div>
<!-- End of the configuration tab-->
{% endblock %}



<!-- Begin of the execution tab-->
{% block executiontab %}
<div class="ui grid stackable">
   <div class="row">
        
        <div class="eight wide column">
            <h3>Velocidade Final do carro 1</h3>
                <div >
                    <div id="plot_time_velocity"></div>
                </div>
        </div>
        <div class="eight wide column">
            <h3>Velocidade final do carro 2</h3>
                <div >
                    <div id="plot_time_velocity2"></div>
                </div>
        </div>
    </div>
    
</div>

    <table id="results_table" class="ui celled table display" style="width:100%">
        <thead>
            <tr>
                <th id="tempo">{% trans "Time" %}</th>
                <th id="delta_tempo_carro1">{% trans "Delta T1" %}</th>
                <th id="delta_tempo_carro2">{% trans "Delta T2" %}</th>
              
            </tr>
        </thead>
    </table>
{% endblock %}   
<!-- End of the execution tab-->

{% block protocol_auxiliary_functions %}

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<script>
  
function process_final_data(data_line){


}

function on_save_experiment_UI(){

}

function on_ready_experiment_UI(){

    configure_slider("poder_acel1")
    configure_slider("poder_acel2")
	configure_slider("cam_segue")
	
	buildPlot1(0,'plot_time_velocity')
	buildPlot2(0,'plot_time_velocity2')
	
	
}

function configure_slider(name){
        $('#slider-'+name).slider({
            min:  protocol_input_arguments[name].minimum,
            max: protocol_input_arguments[name].maximum, 
            step: protocol_input_arguments[name].multipleOf,
            start: protocol_input_arguments[name].default,
            input: '#'+name,
            onChange: function(value) {
                console.log("QQQQQQQQQQQQQQQQQQ "+value)
                $('#'+name).prop("value", value)
                onInputChanged()
           }
        })
        $('#'+name).change(function() {
            if($(this).val() > protocol_input_arguments[name].maximum)
                $(this).prop("value", protocol_input_arguments[name].maximum)
            if($(this).val() < protocol_input_arguments[name].minimum)
                $(this).prop("value", protocol_input_arguments[name].minimum)
            $("#slider-"+name).slider('set value', $(this).val())
            });
    }
	
	
/* build plots*/

function process_partial_data(data_line){
    t1 = parseFloat(data_line.value.delta_tempo_carro1) 
	t2 = parseFloat(data_line.value.delta_tempo_carro2)
	
   
 
  // console.log('t', time)

  // Plotly.update('plot_time_velocity',  {value: time},{}, [0]);
  Plotly.update('plot_time_velocity', {value: t1}, {}, [0]);
  Plotly.update('plot_time_velocity2', {value: t2}, {}, [0]);
//Plotly.update('myDiv', {value: rand()}, {}, [0])
}

function buildPlot1(res, plotdiv) {

console.log(res);
var trace1 = {

    // domain = {'x': [0, 1], 'y': [0, 1]},
      x: [],
      y: [],
      value: 30,
      title: {text: "carro1" },

      mode: 'gauge+number',
      type:"indicator",
 
      name: "res[1]"
    };

  var output_data = [trace1];

  var layout = {
  width: 500, height: 400, margin: { t: 0, b: 0 }
   
  }
   Plotly.newPlot(plotdiv, output_data, layout);
 
}

function buildPlot2(res, plotdiv) {

console.log(res);
var trace2 = {

    // domain = {'x': [0, 1], 'y': [0, 1]},
      x: [],
      y: [],
      value: 0,
      title: {text: "carro2" },

      mode: 'gauge+number',
      type:"indicator",
 
      name: "res[2]"
    };

  var output_data = [trace2];

  var layout = {
  width: 500, height: 400, margin: { t: 0, b: 0 }
   
  }
   Plotly.newPlot(plotdiv, output_data, layout);
 
}

	


</script>
{% endblock %}   


